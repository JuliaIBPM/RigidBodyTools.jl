<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Evaluating velocities on body surfaces · RigidBodyTools.jl</title><meta name="title" content="Evaluating velocities on body surfaces · RigidBodyTools.jl"/><meta property="og:title" content="Evaluating velocities on body surfaces · RigidBodyTools.jl"/><meta property="twitter:title" content="Evaluating velocities on body surfaces · RigidBodyTools.jl"/><meta name="description" content="Documentation for RigidBodyTools.jl."/><meta property="og:description" content="Documentation for RigidBodyTools.jl."/><meta property="twitter:description" content="Documentation for RigidBodyTools.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RigidBodyTools.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Bodies and Transforms</span><ul><li><a class="tocitem" href="../shapes/">Creating bodies</a></li><li><a class="tocitem" href="../transforms/">Plucker vectors and coordinate transforms</a></li><li><a class="tocitem" href="../bodylists/">Lists of bodies and their transforms</a></li></ul></li><li><span class="tocitem">Motions</span><ul><li><a class="tocitem" href="../dofmotions/">Behaviors of degrees of freedom</a></li><li><a class="tocitem" href="../joints/">Joints and body-joint systems</a></li><li><a class="tocitem" href="../exogenous/">Exogenous degrees of freedom</a></li><li><a class="tocitem" href="../deformation/">Deforming bodies</a></li><li class="is-active"><a class="tocitem" href>Evaluating velocities on body surfaces</a><ul class="internal"><li><a class="tocitem" href="#Set-up-the-bodies,-joints,-and-motion"><span>Set up the bodies, joints, and motion</span></a></li><li><a class="tocitem" href="#Evaluate-velocity-on-body-points"><span>Evaluate velocity on body points</span></a></li><li><a class="tocitem" href="#Surface-velocity-functions"><span>Surface velocity functions</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Motions</a></li><li class="is-active"><a href>Evaluating velocities on body surfaces</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Evaluating velocities on body surfaces</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/RigidBodyTools.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/RigidBodyTools.jl/blob/master/test/literate/surfacevelocities.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Evaluating-velocities-on-body-surfaces"><a class="docs-heading-anchor" href="#Evaluating-velocities-on-body-surfaces">Evaluating velocities on body surfaces</a><a id="Evaluating-velocities-on-body-surfaces-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluating-velocities-on-body-surfaces" title="Permalink"></a></h1><p>For use in mechanics problems, it is important to be able to output the velocity of the points on the surfaces of bodies at a given system state and time. We use the function <code>surface_velocity!</code> for this. Here, we will demonstrate its use, and particularly, its various options.</p><p>We will use a simple problem, consisting of two flat plates connected by a <code>RevoluteJoint</code>, and one of the plates connected to the inertial system by a <code>FreeJoint2d</code>, oscillating in y coordinate only.</p><pre><code class="language-julia hljs">using RigidBodyTools
using Plots</code></pre><h2 id="Set-up-the-bodies,-joints,-and-motion"><a class="docs-heading-anchor" href="#Set-up-the-bodies,-joints,-and-motion">Set up the bodies, joints, and motion</a><a id="Set-up-the-bodies,-joints,-and-motion-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-the-bodies,-joints,-and-motion" title="Permalink"></a></h2><pre><code class="language-julia hljs">body1 = Plate(1.0,200)
body2 = deepcopy(body1)

bodies = BodyList([body1,body2])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BodyList(Body[Open polygon with 2 vertices and 200 points
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
, Open polygon with 2 vertices and 200 points
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
])</code></pre><p>Joint 1, connecting body 1 to inertial system</p><pre><code class="language-julia hljs">Xp_to_j1 = MotionTransform(0.0,0.0,0.0)
Xch_to_j1 = MotionTransform(-0.5,0.0,0.0)
dofs1 = [ConstantVelocityDOF(0),ConstantVelocityDOF(0),OscillatoryDOF(1.0,2π,0,0.0)]
joint1 = Joint(FreeJoint2d,0,Xp_to_j1,1,Xch_to_j1,dofs1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Joint of dimension 2 and type FreeJoint2d
   Constrained dofs = [1, 2, 3]
   Exogenous dofs = Int64[]
   Unconstrained dofs = Int64[]
</code></pre><p>Joint 2, connecting body 2 to body 1</p><pre><code class="language-julia hljs">Xp_to_j2 = MotionTransform(0.5,0.0,0.0)
Xch_to_j2 = MotionTransform(-0.5,0.0,0.0)
dofs2 = [OscillatoryDOF(π/4,2π,-π/4,0.0)]
joint2 = Joint(RevoluteJoint,1,Xp_to_j2,2,Xch_to_j2,dofs2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Joint of dimension 2 and type RevoluteJoint
   Constrained dofs = [1]
   Exogenous dofs = Int64[]
   Unconstrained dofs = Int64[]
</code></pre><p>Assemble, and get the initial joint state vector at t = 0</p><pre><code class="language-julia hljs">joints = [joint1,joint2]
ls = RigidBodyMotion(joints,bodies)
t = 0
x = init_motion_state(bodies,ls;tinit=t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
 0.0
 0.0
 0.0
 0.5553603672697958</code></pre><p>Let&#39;s plot the bodies, just to visualize their current configuration.</p><pre><code class="language-julia hljs">update_body!(bodies,x,ls)
plot(bodies,xlim=(-1,3),ylim=(-2,2))</code></pre><img src="4e09edcb.svg" alt="Example block output"/><p>Because of the phase difference, joint 2 is bent at an angle initially.</p><h2 id="Evaluate-velocity-on-body-points"><a class="docs-heading-anchor" href="#Evaluate-velocity-on-body-points">Evaluate velocity on body points</a><a id="Evaluate-velocity-on-body-points-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluate-velocity-on-body-points" title="Permalink"></a></h2><p>First, initialize vectors for the <code>u</code> and <code>v</code> components in this 2d example, using the <code>zero_body</code> function.</p><pre><code class="language-julia hljs">u, v = zero_body(bodies), zero_body(bodies)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])</code></pre><p>Now evaluate the velocities at time 0</p><pre><code class="language-julia hljs">surface_velocity!(u,v,bodies,x,ls,t)</code></pre><p>We can plot these on each body using the <code>view</code> function for <code>BodyList</code>. For example, the vectors of u and v velocities on body 1 are</p><pre><code class="language-julia hljs">bodyid = 1
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u1&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v1&quot;)</code></pre><img src="e7a98845.svg" alt="Example block output"/><p>This shows a pure vertical translation. On body 2, we see a mixture of the translation of body 1, plus the rotation of joint 2, which is reflected in the linear variation. Since the plate is at an angle, some of this rotation shows up as a negative u component.</p><pre><code class="language-julia hljs">bodyid = 2
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u2&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v2&quot;)</code></pre><img src="dcbb07fb.svg" alt="Example block output"/><p>We can compute these velocities in different components, using the optional <code>axes</code> argument. For example, let&#39;s see the velocities on body 2 in its own coordinate system</p><pre><code class="language-julia hljs">surface_velocity!(u,v,bodies,x,ls,t;axes=2)
bodyid = 2
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u2&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v2&quot;)</code></pre><img src="a4688bad.svg" alt="Example block output"/><p>Now only the v component (the component perpendicular to the plate) depicts the rotation, and the u component has only a portion of the translational motion from joint 1.</p><p>We can also compute the velocity relative to a body reference frame, using the optional <code>frame</code> argument. Let&#39;s compute the velocities relative to the velocity of body 1 (and in body 1 coordinates) and plot them.</p><pre><code class="language-julia hljs">surface_velocity!(u,v,bodies,x,ls,t;axes=1,frame=1)
bodyid = 1
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u1&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v1&quot;)</code></pre><img src="62338a23.svg" alt="Example block output"/><p>Body 1 has no velocity in this reference frame. And body 2 has only a pure rotation...</p><pre><code class="language-julia hljs">bodyid = 2
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u2&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v2&quot;)</code></pre><img src="0c98320e.svg" alt="Example block output"/><p>We do not have to remove all of the motion of the reference body when we compute velocity in a moving reference frame. We can use the <code>motion_part</code> keyword argument to remove only, e.g., <code>:angular</code> or <code>:linear</code> part (instead of <code>:full</code>, the default). For example, if we remove the angular part of body 2&#39;s motion, we are left with only the translation from joint 1</p><pre><code class="language-julia hljs">surface_velocity!(u,v,bodies,x,ls,t;axes=2,frame=2,motion_part=:angular)
bodyid = 2
s = arccoord(bodies[bodyid])
plot(s,view(u,bodies,bodyid),ylim=(-20,20),label=&quot;u2&quot;)
plot!(s,view(v,bodies,bodyid),label=&quot;v2&quot;)</code></pre><img src="16500d03.svg" alt="Example block output"/><h2 id="Surface-velocity-functions"><a class="docs-heading-anchor" href="#Surface-velocity-functions">Surface velocity functions</a><a id="Surface-velocity-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-velocity-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RigidBodyTools.surface_velocity!" href="#RigidBodyTools.surface_velocity!"><code>RigidBodyTools.surface_velocity!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">surface_velocity!(u::AbstractVector,v::AbstractVector,bl::BodyList,x::AbstractVector,m::RigidBodyMotion,t::Real[;axes=0,frame=axes,motion_part=:full])</code></pre><p>Calculate the surface velocity components <code>u</code> and <code>v</code> for the points on bodies <code>bl</code>. The function evaluates prescribed kinematics at time <code>t</code> and extracts non-prescribed (exogenous and unconstrained) velocities from state vector <code>x</code>. There are three keyword arguments that can change the behavior of this function: <code>axes</code> determines whether the components returned are expressed in the inertial coordinate system (0, the default) or another body&#39;s coordinates (the body ID); <code>frame</code> specifies that the motion should be measured relative to another reference body&#39;s velocity (by default, 0); and <code>motion_part</code> determines whether the entire reference body velocity is used (<code>:full</code>, the default), only the angular part (<code>:angular</code>), or only the linear part (<code>:linear</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIBPM/RigidBodyTools.jl/blob/bb374b6df5f9435b9978fcfd51d4f5f8156baaf5/src/rigidbodymotions.jl#L618-L629">source</a></section></article><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../deformation/">« Deforming bodies</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Friday 25 April 2025 18:41">Friday 25 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
